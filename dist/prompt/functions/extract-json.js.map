{"version":3,"file":"extract-json.js","sourceRoot":"","sources":["../../../src/prompt/functions/extract-json.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,YAAY,CAAC;AACxC,OAAO,SAAS,MAAM,YAAY,CAAC;AAGnC,2CAA2C;AAC3C,MAAM,UAAU,iBAAiB,CAAC,GAAW;IAC3C,gDAAgD;IAChD,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC/B,MAAM,GAAG,GAAG,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IACjC,MAAM,YAAY,GAAG,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IAClE,IAAI,oBAAoB,GAAG,YAAY,CAAC;IAExC,IAAI,CAAC;QACH,oBAAoB,GAAG,UAAU,CAAC,YAAY,CAAC,CAAC;QAChD,MAAM,IAAI,GAAe,IAAI,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC;QAC1D,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,yDAAyD;QACzD,MAAM,IAAI,GAAe,SAAS,CAAC,oBAAoB,CAAC,CAAC;QACzD,OAAO,IAAI,CAAC;IACd,CAAC;AACH,CAAC","sourcesContent":["import { jsonrepair } from 'jsonrepair';\nimport parseJson from 'parse-json';\nimport type { JsonObject } from 'type-fest';\n\n/** Extract a JSON object from a string. */\nexport function extractJsonObject(str: string): JsonObject {\n  // Extract just the JSON object from the string.\n  const start = str.indexOf('{');\n  const end = str.lastIndexOf('}');\n  const objectString = str.slice(start, end ? end + 1 : str.length);\n  let repairedObjectString = objectString;\n\n  try {\n    repairedObjectString = jsonrepair(objectString);\n    const json: JsonObject = JSON.parse(repairedObjectString);\n    return json;\n  } catch (error) {\n    // Parse again with parse-json for better error messages.\n    const json: JsonObject = parseJson(repairedObjectString);\n    return json;\n  }\n}\n"]}